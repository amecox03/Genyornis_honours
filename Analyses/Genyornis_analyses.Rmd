---
title: "Genyornis_regressions"
author: "Amelia Cox, Vera Weisbecker"
date: "2024-04-29"
output: html_document
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, results='hide' )
```


```{r setup of libraries}
#this sets the directory to the source directory without having to manually click your way there
library(rstudioapi) # Safely Access the RStudio API
setwd(dirname(getActiveDocumentContext()$path))

library(Ternary)
library(tidyverse)
library(RColorBrewer)
library(xtable)

```


```{r data}
#loading data
data<- read.csv (file = "../Data/Raw/honours_data.csv")

data_plot <- cbind (data[,1:3], log (data[,4:18]), data[,19:39])

#making a dataset that excludes dromornithids
data_noD <- data[-c(125:135),]

datanoD_plot <- cbind (data_noD[,1:3], log (data_noD[,4:16]))

```


```{r geomean}

#code from Keirnan et al. 2022
#geomean <- apply(Size_containing_data[,c(4,8:14)], 1, prod)^(1/ncol(Size_containing_data[,c(4,8:14)]))



```


```{r making a subset dataframe and calculating means base script}
# Example data frame
data <- data.frame(
  Name = c("John", "Jane", "John", "Alice", "Bob"),
  Score1 = c(80, 75, 85, 90, 95),
  Score2 = c(70, 65, 75, 80, 85)
)

# Names for which you want to calculate means
target_names <- c("John", "Bob")

# Step 1: Subset rows with target names
subset_data <- data[data$Name %in% target_names, ]

# Step 2: Calculate mean for each column in the subset
means <- colMeans(subset_data[, c("Score1", "Score2")])

# Step 3: Print or use the means as needed
print(means)

```


```{r aepyornithid hindlimb data from Hansford & Turvey 2018; calculating means}

data_aepyorn <- read.csv(file = "../Data/Raw/Aepyronithid_hindlimb_measurements.csv")


#some numeric columns import as non-numeric, as.numeric changes these columns into numeric columns
data_aepyorn[, 5] <- as.numeric(data_aepyorn [,5])
data_aepyorn[,10] <- as.numeric (data_aepyorn[,10])
data_aepyorn[,12] <- as.numeric (data_aepyorn[,12])
data_aepyorn[,15] <- as.numeric (data_aepyorn[,15])


#species name for which mean is to be calculated for A. hildebrandti
aep.hil <- c("hildebrandti")


#a subset data frame for the rows that i want to target for A. hildebrandti
subset_data <- data_aepyorn[data_aepyorn$genus %in% aep.hil,]


#calculate the means of Aepyornis hildebrandti
aep.hilm <- colMeans(subset_data[, c("fL", "fPW", "fDW", "fCr.Ca","fM.L","tbL","tbPW", "tbDW","tbCr.Ca","tbM.L","tmtL","tmtD.P","tmtM.L")], na.rm = TRUE)


#printing the means for Aepyornis hildebrandti
print(aep.hilm)



#species name for which mean is to be calculated for A. maximus
aep.max <- c("maximus")


#a subset data frame for the rows that i want to target for A. maximus
subset_datam <- data_aepyorn[data_aepyorn$genus %in% aep.max,]


#calculate the means of Aepyornis maximus
aep.maxi <- colMeans(subset_datam[, c("fL", "fPW", "fDW", "fCr.Ca","fM.L","tbL","tbPW", "tbDW","tbCr.Ca","tbM.L","tmtL","tmtD.P","tmtM.L")], na.rm = TRUE)


#printing the means for Aepyornis maximus
print(aep.maxi)



#species name for which mean is to be calculated for M. modestus
mul.mod <- c("modestus")


#a subset data frame for the rows that i want to target for M. modestus
subset_datamm <- data_aepyorn[data_aepyorn$genus %in% mul.mod,]


#calculate the means of M. modestus
mul.mode <- colMeans(subset_datamm[, c("fL", "fPW", "fDW", "fCr.Ca","fM.L","tbL","tbPW", "tbDW","tbCr.Ca","tbM.L","tmtL","tmtD.P","tmtM.L")], na.rm = TRUE)


#printing the means for M. modestus
print(mul.mode)


```


#SUMMARY STATISTICS

```{r summary stats}
sum <- data %>%
  group_by(species)  %>%
  summarise_all(mean, sd, na.rm = TRUE)
  
write.csv(sum, file = 'honours_summary_stats.csv')

sum <- data %>%
  group_by(species)

```



#LEAST SQUARE REGRESSIONS
#Titles also often go here - up to you :-)
#Read up on Reduced Major Axis (RMA) regression which allows for both variable being responses (rather than y being response, x being predictor - but don't get too hung up about this now :-))

#The default is 95% confidence interval. These intervals seem very narrow! But the below runs an example that shows the same. But we are interested in the prediction intervals, anyway.

```{r 95% confidence interval basic script}

#make this example reproducible
set.seed(0)

#create dataset
x <- rnorm(100)
y <- x*2 + rnorm(100)
df <- data.frame(x = x, y = y)

#fit linear regression model
model <- lm(y ~ x, data = df) 

#get predicted y values using regression equation
newx <- seq(min(df$x), max(df$x), length.out=100)
preds <- predict(model, newdata = data.frame(x=newx), interval = 'confidence')

#create plot of x vs. y
plot(y ~ x, data = df)

#fill in area between regression line and confidence interval
polygon(c(rev(newx), newx), c(rev(preds[ ,3]), preds[ ,2]), col = 'grey90', border = NA)

#add fitted regression line
abline(model)

#add dashed lines for confidence bands
lines(newx, preds[ ,3], lty = 'dashed', col = 'black')
lines(newx, preds[ ,2], lty = 'dashed', col = 'black')


```


```{r set colours and symbols}

#Also here setting up a vector of colours you can use to highlight _Genyornis_
#make a vector of just pink
colours <- rep("#33cc33",nrow(data_plot))
#make a vector where any species name that has Genyornis is assigned purple
colours[which(data_plot$species == "Genyornis newtoni")] <- "#33cc33"
colours[which(data_plot$species == "Illbandornis lawsoni")] <- "#33cc33"
colours[which(data_plot$species == "Illbandornis woodburnei")] <- "#33cc33"
colours[which(data_plot$species == "Dromornis stirtoni")] <- "#33cc33"
colours[which(data_plot$order == "Anseriformes")] <- "#ff0055"
colours[which(data_plot$order == "Galliformes")] <- "#800080"
colours[which(data_plot$order == "Casuariiformes")] <- "#3333cc"
colours[which(data_plot$order == "Struthioniformes")] <- "#3333cc"
colours[which(data_plot$order == "Dinornithiformes")] <- "#F77F00"
colours[which(data_plot$order == "Aepyornithiformes")] <- "#cc0000"

col_values <- c("Genyornis newtoni" = "#33cc33","Illbandornis lawsoni" = "#33cc33", "Illbandornis woodburnei" = "#33cc33", "Dromornis stirtoni" = "#33cc33", "Anhima cornuta" = "#ff0055", "Anseranas semipalmata" = "#ff0055", "Cereopsis novaehollandiae" = "#ff0055", "Leipoa ocellata" = "#800080", "Alectura lathami" = "#800080", "Casuarius casuarius" = "#3333cc", "Dromaius novaehollandiae" = "#3333cc", "Struthio camelus" = "#3333cc", "Dinornis robustus" = "#F77F00", "Dinornis novaezealandiae" = "#F77F00", "Pachyornis elephantopus" = "#F77F00", "Aepyornis hildebrandti" = "#cc0000", "Aepyornis maximus" = "#cc0000", "Mullerornis modestus" = "#cc0000")

col_vector <- col_values [data_plot$species]

pch_values <- c("Genyornis newtoni" = 19,"Illbandornis lawsoni" = 10, "Illbandornis woodburnei" = 13, "Dromornis stirtoni" = 8, "Anhima cornuta" = 17, "Anseranas semipalmata" = 17, "Cereopsis novaehollandiae" = 17, "Leipoa ocellata" = 15, "Alectura lathami" = 15, "Casuarius casuarius" = 18, "Dromaius novaehollandiae" = 18, "Struthio camelus" = 18, "Dinornis robustus" = 18, "Dinornis novaezealandiae" = 18, "Pachyornis elephantopus" = 18, "Aepyornis hildebrandti" = 18, "Aepyornis maximus" = 18, "Mullerornis modestus" = 18)

#creating a vector of pch values based on species
pch_vector <- pch_values[data_plot$species]

```


```{r femur width vs tibiotarsus width}

#getting a model for predicting CIs
model1 <- lm(fM.L ~ tbM.L, data=datanoD_plot)
summary(model1)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_x <- sort(datanoD_plot$tbM.L)[1]
max_x <- sort(datanoD_plot$tbM.L, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newx <- seq(min_x-1,max_x+1,by = 0.05 )

#plot confidence intervals

#This only works if the data are already logged. Not my preference but hey.
conf_interval <- predict(model1, newdata=data.frame(tbM.L = newx), interval="prediction",    level = 0.95)

plot(data = data_plot, fM.L ~ tbM.L, 
     xlim=c(1.6,4.5), 
     ylim=c(1.7,4.5), 
     pch=19, col=colours, ylab = "Mediolateral width of the femur", xlab = "Mediolateral width of the tibiotarsus",axes = TRUE, frame.plot = TRUE); abline(model1, col="black" )

lines(newx, conf_interval[,2], col="black", lty=3)

lines(newx, conf_interval[,3], col="black", lty=3)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newx), newx), c(rev(conf_interval[ ,3]), conf_interval[ ,2]), density = 25, col = 'grey90', border = NA)


#replotting points and prediction intervals
points(data = data_plot, fM.L ~ tbM.L, 
     pch=19, col=colours); abline(model1, col="black" )
lines(newx, conf_interval[,2], col="black", lty=3)
lines(newx, conf_interval[,3], col="black", lty=3)


#adding legend
legend("bottomright",
       legend = c("Galliformes", "Anseriformes", "Extant Palaeognathae",  "Dinornithiformes", "Aepyornithiformes", substitute(paste(italic("Illbandornis lawsoni"))), substitute(paste(italic("Illbandornos woodburnei"))), substitute(paste(italic("Genyornis newtoni")))), #substitute(paste(italic("name"))) makes the names appear italiseced
       pch = c(15, 17, 18, 18, 18, 10, 13, 19),
       col = c("#800080", "#ff0055", "#3333cc", "#F77F00", "#cc0000", "#33cc33", "#33cc33", "#33cc33"),
       pt.bg = c("#800080", "#ff0055", "#3333cc", "#F77F00", "#cc0000", "#33cc33", "#33cc33", "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")


```


```{r femur width vs tibiotarsus width craniocaudal}

#getting a model for predicting CIs
modelCW <- lm(fCr.Ca ~ tbCr.Ca, data=datanoD_plot)
summary(modelCW)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_xCW <- sort(datanoD_plot$tbCr.Ca)[1]
max_xCW <- sort(datanoD_plot$tbCr.Ca, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxCW <- seq(min_xCW-1,max_xCW+1,by = 0.05 )

#plot confidence intervals

#This only works if the data are already logged. Not my preference but hey.
conf_intervalCW <- predict(modelCW, newdata=data.frame(tbCr.Ca = newxCW), interval="prediction",    level = 0.95)


plot(data = data_plot, fCr.Ca ~ tbCr.Ca, 
     xlim=c(1.6,4.5), 
     ylim=c(1.7,4.5), 
     pch=pch_vector, col=colours, ylab = "Craniocaudal width of the femur", xlab = "Craniocaudal width of the tibiotarsus",axes = TRUE, frame.plot = TRUE); abline(modelCW, col="black" )

lines(newxCW, conf_intervalCW[,2], col="black", lty=3)
lines(newxCW, conf_intervalCW[,3], col="black", lty=3)

 #fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxCW), newxCW), c(rev(conf_intervalCW[ ,3]), conf_intervalCW[ ,2]), density = 25, col = 'grey90', border = NA)



points(data = data_plot, fCr.Ca ~ tbCr.Ca, 
     pch=pch_vector, col=colours); abline(modelCW, col="black" )

lines(newxCW, conf_intervalCW[,2], col="black", lty=3)
lines(newxCW, conf_intervalCW[,3], col="black", lty=3)


#adding legend
legend("bottomright",
       legend = c("Galliformes", "Anseriformes", "Extant Palaeognathae",  "Aepyornithiformes",  substitute(paste(italic("Genyornis newtoni")))),
       pch = c(15, 17, 18, 18, 19),
       col = c("#800080", "#ff0055", "#3333cc",  "#cc0000",  "#33cc33"),
       pt.bg = c("#800080", "#ff0055", "#3333cc",  "#cc0000", "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")


```


```{r length vs width f}

#getting a model for predicting CIs
modelFLW <- lm(fM.L ~ fL, data=datanoD_plot)
summary(modelFLW)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_xW <- sort(datanoD_plot$fL)[1]
max_xW <- sort(datanoD_plot$fL, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxW <- seq(min_xW-1,max_xW+1,by = 0.05 )

#plot confidence intervals

#This only works if the data are already logged. Not my preference but hey.
conf_intervalW <- predict(modelFLW, newdata=data.frame(fL = newxW), interval="prediction", level = 0.95)



plot(data = data_plot, fM.L ~ fL, 
     pch=19, col=colours, ylab = "Mediolateral width of the femur", xlab = "Femur length", axes = TRUE, frame.plot = TRUE); abline(modelFLW, col="black" )

lines(newxW, conf_intervalW [,2], col="black", lty=3)
lines(newxW, conf_intervalW [,3], col="black", lty=3)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxW), newxW), c(rev(conf_intervalW [ ,3]), conf_intervalW[ ,2]),density = 25, col = 'grey90', border = NA)


#replotting points and prediction intervals
points(data = data_plot, fM.L ~ fL,
     pch=19, col=colours); abline(modelFLW, col="black" )
lines(newxW, conf_intervalW [,2], col="black", lty=3)
lines(newxW, conf_intervalW [,3], col="black", lty=3)

#adding legend
legend("bottomright",
       legend = c("Galliformes", "Anseriformes", "Extant Palaeognathae",  "Dinornithiformes", "Aepyornithiformes", substitute(paste(italic("Illbandornis lawsoni"))), substitute(paste(italic("Illbandornos woodburnei"))), substitute(paste(italic("Genyornis newtoni")))),
       pch = c(15, 17, 18, 18, 18, 10, 13, 19),
       col = c("#800080", "#ff0055", "#3333cc", "#F77F00", "#cc0000", "#33cc33", "#33cc33", "#33cc33"),
       pt.bg = c("#800080", "#ff0055", "#3333cc", "#F77F00", "#cc0000", "#33cc33", "#33cc33", "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")

```

```{r plotting craniocaudal width against length}

#getting a model for predicting CIs
modelFLW2 <- lm(fCr.Ca ~ fL, data=datanoD_plot)
summary(modelFLW2)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_xW2 <- sort(datanoD_plot$fL)[1]
max_xW2 <- sort(datanoD_plot$fL, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxW2 <- seq(min_xW-1,max_xW+1,by = 0.05 )

#plot confidence intervals

#This only works if the data are already logged. Not my preference but hey.
conf_intervalW2 <- predict(modelFLW2, newdata=data.frame(fL = newxW2), interval="prediction", level = 0.95)



plot(data = data_plot, fCr.Ca ~ fL, 
     pch=pch_vector, col=colours, ylab = "Craniocaudal width of the femur", xlab = "Femur length", axes = TRUE, frame.plot = TRUE); abline(modelFLW, col="black" )

lines(newxW2, conf_intervalW2 [,2], col="black", lty=3)
lines(newxW2, conf_intervalW2 [,3], col="black", lty=3)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxW2), newxW2), c(rev(conf_intervalW2 [ ,3]), conf_intervalW2[ ,2]),density = 25, col = 'grey90', border = NA)


#replotting points
points(data = data_plot, fCr.Ca ~ fL, 
     pch=pch_vector, col=colours); abline(modelFLW, col="black" )
lines(newxW2, conf_intervalW2 [,2], col="black", lty=3)
lines(newxW2, conf_intervalW2 [,3], col="black", lty=3)

#adding legend
legend("bottomright",
       legend = c("Galliformes", "Anseriformes", "Extant Palaeognathae",  "Aepyornithiformes", substitute(paste(italic("Genyornis newtoni")))),
       pch = c(15, 17, 18, 18, 19),
       col = c("#800080", "#ff0055", "#3333cc", "#cc0000", "#33cc33"),
       pt.bg = c("#800080", "#ff0055", "#3333cc","#cc0000",  "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")


```


```{r plotting the femur and tibia length}

#getting a model for predicting CIs
modelFTL <- lm(fL ~ tbL, data=datanoD_plot)
summary(modelFTL)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_xL <- sort(datanoD_plot$tbL)[1]
max_xL <- sort(datanoD_plot$tbL, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxL <- seq(min_xL-1,max_xL+1,by = 0.05 )

#plot confidence intervals

#This only works if the data are already logged. Not my preference but hey.
conf_intervalL <- predict(modelFTL, newdata=data.frame(tbL = newxL), interval="prediction",    level = 0.95)



plot(data = data_plot, fL ~ tbL,
     pch=19, col=colours, ylab = "Femur length", xlab = "Tibiotarsus", axes = TRUE, frame.plot = TRUE); abline(modelFTL, col="black" )

lines(newxL, conf_intervalL [,2], col="black", lty=3)
lines(newxL, conf_intervalL [,3], col="black", lty=3)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxL), newxL), c(rev(conf_intervalL [ ,3]), conf_intervalL[ ,2]), density = 25, col = 'grey90', border = NA)


#replotting points and prediction intervals
points(data = data_plot, fL ~ tbL, 
     pch=19, col=colours); abline(modelFTL, col="black" )
lines(newxL, conf_intervalL [,2], col="black", lty=3)
lines(newxL, conf_intervalL [,3], col="black", lty=3)

#adding legend
legend("bottomright",
       legend = c("Galliformes", "Anseriformes", "Extant Palaeognathae",  "Dinornithiformes", "Aepyornithiformes", substitute(paste(italic("Illbandornis lawsoni"))), substitute(paste(italic("Illbandornos woodburnei"))), substitute(paste(italic("Dromornis stirtoni"))), substitute(paste(italic("Genyornis newtoni")))),
       pch = c(15, 17, 18, 18, 18, 10, 13, 8, 19),
       col = c("#800080", "#ff0055", "#3333cc", "#F77F00", "#cc0000", "#33cc33", "#33cc33", "#33cc33","#33cc33"),
       pt.bg = c("#800080", "#ff0055", "#3333cc", "#F77F00", "#cc0000", "#33cc33", "#33cc33", "#33cc33","#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")

```


```{r plotting femur widths against each other}

#getting a model for predicting CIs
modelFW <- lm(fM.L ~ fCr.Ca, data=datanoD_plot)
summary(modelFW)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_xFW <- sort(datanoD_plot$fCr.Ca)[1]
max_xFW <- sort(datanoD_plot$fCr.Ca, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxFW <- seq(min_xFW-1,max_xFW+1,by = 0.05 )

#plot confidence intervals
#This only works if the data are already logged. Not my preference but hey.
conf_intervalFW <- predict(modelFW, newdata=data.frame(fCr.Ca = newxFW), interval="prediction", level = 0.95)

#plotting the femur widths
plot(data=data_plot, fM.L ~ fCr.Ca,
     pch=19, col=colours, ylab = "Mediolateral width", xlab = "Craniocaudal width",axes = TRUE, frame.plot = TRUE); abline(modelFW, col="black" )

#for some reason the newxFW has returned a large value than confidence interval
lines(newxFW, conf_intervalFW [,2], col="black", lty=3)
lines(newxFW, conf_intervalFW [,3], col="black", lty=3)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxFW), newxFW), c(rev(conf_intervalFW [ ,3]), conf_intervalFW[ ,2]),density = 25, col = 'grey90', border = NA)

#replotting points and prediction intervals
points(data=data_plot, fM.L ~ fCr.Ca,
     pch=19, col=colours); abline(modelFW, col="black" )
lines(newxFW, conf_intervalFW [,2], col="black", lty=3)
lines(newxFW, conf_intervalFW [,3], col="black", lty=3)


legend("bottomright",
       legend = c("Galliformes", "Anseriformes", "Extant Palaeognathae",  "Aepyornithiformes", substitute(paste(italic("Genyornis newtoni")))),
       pch = c(15, 17, 18,  18,  19),
       col = c("#800080", "#ff0055", "#3333cc",  "#cc0000", "#33cc33"),
       pt.bg = c("#800080", "#ff0055", "#3333cc", "#cc0000", "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")

```


```{r plotting the tibiotarsus widths against each other}

#getting a model for predicting CIs
modelTW <- lm(tbM.L ~ tbCr.Ca, data=datanoD_plot)
summary(modelTW)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_xTW <- sort(datanoD_plot$tbCr.Ca)[1]
max_xTW <- sort(datanoD_plot$tbCr.Ca, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxTW <- seq(min_xTW-1,max_xTW+1,by = 0.05 )

#plot confidence intervals
#This only works if the data are already logged. Not my preference but hey.
conf_intervalTW <- predict(modelTW, newdata=data.frame(tbCr.Ca = newxTW), interval="prediction", level = 0.95)

#plotting the femur widths
plot(data=data_plot, tbM.L ~ tbCr.Ca,
     pch=pch_vector, col=colours, ylab = "Tibiotarsus mediolateral width", xlab = "Tibiotarsus craniocaudal width",axes = TRUE, frame.plot = TRUE); abline(modelTW, col="black" )

#for some reason the newxFW has returned a large value than confidence interval
lines(newxTW, conf_intervalTW [,2], col="black", lty=3)
lines(newxTW, conf_intervalTW [,3], col="black", lty=3)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxTW), newxTW), c(rev(conf_intervalTW [ ,3]), conf_intervalTW[ ,2]),density = 25, col = 'grey90', border = NA)

#replotting points and prediction intervals
points(data=data_plot, tbM.L ~ tbCr.Ca,
     pch=pch_vector, col=colours); abline(modelTW, col="black" )
lines(newxTW, conf_intervalTW [,2], col="black", lty=3)
lines(newxTW, conf_intervalTW [,3], col="black", lty=3)

legend("bottomright",
       legend = c("Galliformes", "Anseriformes", "Extant Palaeognathae",  "Aepyornithiformes", substitute(paste(italic("Genyornis newtoni")))),
       pch = c(15, 17, 18,  18,  19),
       col = c("#800080", "#ff0055", "#3333cc",  "#cc0000", "#33cc33"),
       pt.bg = c("#800080", "#ff0055", "#3333cc", "#cc0000", "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")

```


```{r plotting tarsometatarsus widths against each other}

#getting a model for predicting CIs
modelTMTW <- lm(tmtM.L ~ tmtD.P, data=datanoD_plot)
summary(modelTMTW)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_xTMTW <- sort(datanoD_plot$tmtD.P)[1]
max_xTMTW <- sort(datanoD_plot$tmtD.P, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxTMTW <- seq(min_xTW-1,max_xTW+1,by = 0.05 )

#plot confidence intervals
#This only works if the data are already logged. Not my preference but hey.
conf_intervalTMTW <- predict(modelTMTW, newdata=data.frame(tmtD.P = newxTMTW), interval="prediction", level = 0.95)

#plotting the femur widths
plot(data=data_plot, tmtM.L ~ tmtD.P,
     pch=pch_vector, col=colours, ylab = "Tarsometatarsus mediolateral width", xlab = "Tarsometatarsus craniocaudal width",axes = TRUE, frame.plot = TRUE); abline(modelTMTW, col="black" )

#for some reason the newxFW has returned a large value than confidence interval
lines(newxTMTW, conf_intervalTMTW [,2], col="black", lty=3)
lines(newxTMTW, conf_intervalTMTW [,3], col="black", lty=3)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxTMTW), newxTMTW), c(rev(conf_intervalTMTW [ ,3]), conf_intervalTMTW[ ,2]),density = 25, col = 'grey90', border = NA)

#replotting points and prediction intervals
points(data=data_plot, tmtM.L ~ tmtD.P,
     pch=pch_vector, col=colours); abline(modelTMTW, col="black" )
lines(newxTMTW, conf_intervalTMTW [,2], col="black", lty=3)
lines(newxTMTW, conf_intervalTMTW [,3], col="black", lty=3)


legend("bottomright",
       legend = c("Galliformes", "Anseriformes", "Extant Palaeognathae",  "Aepyornithiformes", substitute(paste(italic("Genyornis newtoni")))),
       pch = c(15, 17, 18,  18,  19),
       col = c("#800080", "#ff0055", "#3333cc",  "#cc0000", "#33cc33"),
       pt.bg = c("#800080", "#ff0055", "#3333cc", "#cc0000", "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")


```


```{r plotting circumference}
#getting a model for predicting CIs
modelCirc<- lm(fCIRC ~ tbCIRC, data=datanoD_plot)
summary(modelCirc)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_xCIRC <- sort(datanoD_plot$tbCIRC)[1]
max_xCIRC <- sort(datanoD_plot$tbCIRC, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxCIRC <- seq(min_xCIRC-1,max_xCIRC+1,by = 0.05 )

#plot confidence intervals

#This only works if the data are already logged. Not my preference but hey.
conf_intervalCIRC <- predict(modelCirc, newdata=data.frame(tbCIRC = newxCIRC), interval="prediction", level = 0.95)

plot(data=data_plot, fCIRC ~ tbCIRC, 
     pch=pch_vector, col=colours, ylab = "Femur circumference", xlab = "Tibiotarsus circumference",axes = TRUE, frame.plot = TRUE); abline(modelCirc, col="black" )

lines(newxCIRC, conf_intervalCIRC [,2], col="black", lty=3)
lines(newxCIRC, conf_intervalCIRC [,3], col="black", lty=3)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxCIRC), newxCIRC), c(rev(conf_intervalCIRC [ ,3]), conf_intervalCIRC[ ,2]),density = 25, col = 'grey90', border = NA)

#replotting points and prediction intervals
points(data=data_plot, fCIRC ~ tbCIRC, 
     pch=19, col=colours); abline(modelCirc, col="black" )
lines(newxCIRC, conf_intervalCIRC [,2], col="black", lty=3)
lines(newxCIRC, conf_intervalCIRC [,3], col="black", lty=3)

legend("bottomright",
       legend = c("Galliformes", "Anseriformes", "Extant Palaeognathae", substitute(paste(italic("Dromornis stirtoni"))), substitute(paste(italic("Genyornis newtoni")))),
       pch = c(15, 17, 18, 8, 19),
       col = c("#800080", "#ff0055", "#3333cc", "#33cc33",  "#33cc33"),
       pt.bg = c("#800080", "#ff0055", "#3333cc", "#33cc33", "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")

```


```{r seperate data set with just the large flightless birds}

#make a data set with extant ratites
ratite <- data[c(5:25),]

#make a data set with extinct large birds (ratites + dromorntithids)
extinct <- data[c(78:132),]

#combine the 2 datasets
largebirds_data <- rbind(ratite, extinct)

#making sure the linear measurements are log transformed
largebirds_plot <- cbind (largebirds_data[,1:3], log (largebirds_data[,4:16]))



#make a data set without dromornithids
extinct_noD <- data[c(78:124),]

#combined the 2 datasets
lb_noD <-largebirds_data <- rbind(ratite, extinct_noD)

#making sure the linear measurements are log transformed
lb_noD_plot <- cbind (largebirds_data[,1:3], log (largebirds_data[,4:16]))

```


```{r large bird colours and symbols}

#Also here setting up a vector of colours you can use to highlight _Genyornis_
#make a vector of just pink
colours <- rep("#33cc33",nrow(largebirds_plot))
#make a vector where any species name that has Genyornis is assigned purple
colours[which(largebirds_plot$species == "Genyornis newtoni")] <- "#33cc33"
colours[which(largebirds_plot$species == "Illbandornis lawsoni")] <- "#33cc33"
colours[which(largebirds_plot$species == "Illbandornis woodburnei")] <- "#33cc33"
colours[which(largebirds_plot$species == "Dromornis stirtoni")] <- "#33cc33"
colours[which(largebirds_plot$order == "Casuariiformes")] <- "#3333cc"
colours[which(largebirds_plot$order == "Struthioniformes")] <- "#3333cc"
colours[which(largebirds_plot$order == "Dinornithiformes")] <- "#F77F00"
colours[which(largebirds_plot$order == "Aepyornithiformes")] <- "#cc0000"

col_values2 <- c("Genyornis newtoni" = "#33cc33","Illbandornis lawsoni" = "#33cc33", "Illbandornis woodburnei" = "#33cc33", "Dromornis stirtoni" = "#33cc33",  "Casuarius casuarius" = "#3333cc", "Dromaius novaehollandiae" = "#3333cc", "Struthio camelus" = "#3333cc", "Dinornis robustus" = "#F77F00", "Dinornis novaezealandiae" = "#F77F00", "Pachyornis elephantopus" = "#F77F00", "Aepyornis hildebrandti" = "#cc0000", "Aepyornis maximus" = "#cc0000", "Mullerornis modestus" = "#cc0000")

col_vector2 <- col_values [largebirds_plot$species]

pch_values2 <- c("Genyornis newtoni" = 19,"Illbandornis lawsoni" = 10, "Illbandornis woodburnei" = 13, "Dromornis stirtoni" = 8,  "Casuarius casuarius" = 18, "Dromaius novaehollandiae" = 18, "Struthio camelus" = 18, "Dinornis robustus" = 18, "Dinornis novaezealandiae" = 18, "Pachyornis elephantopus" = 18, "Aepyornis hildebrandti" = 18, "Aepyornis maximus" = 18, "Mullerornis modestus" = 18)

pch_vector2 <- pch_values2[largebirds_plot$species]

```


```{r large bird regression for femur width and tibiotarsus width}
#linear model of the femur width vs tibia width in large flightless birds
model3 <- lm(fM.L ~ tbM.L, data=lb_noD_plot)

#summary output of the linear model
summary (model3)

min_xB <- sort(lb_noD_plot$tbM.L)[1]
max_xB <- sort(lb_noD_plot$tbM.L, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxB <- seq(min_xB-1,max_xB+1,by = 0.05)

#plot confidence intervals

#This only works if the data are already logged. Not my preference but hey.
conf_intervalB <- predict(model3, newdata=data.frame(tbM.L = newxB), interval="prediction", level = 0.95)


plot (data=largebirds_plot, fM.L ~ tbM.L,
     pch=19, col=colours, ylab = "Mediolateral width of the femur", xlab = "Mediolateral width of the tibiotarsus",axes = TRUE, frame.plot = TRUE ); abline(model3, col="black" )


lines(newxB, conf_intervalB[,2], col="black", lty=3)
lines(newxB, conf_intervalB[,3], col="black", lty=3)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxB), newxB), c(rev(conf_intervalB[ ,3]), conf_intervalB[ ,2]), density = 25, col = 'grey90', border = NA)



points(data=largebirds_plot, fM.L ~ tbM.L,
     pch=19, col=colours); abline(model3, col="black" )

lines(newxB, conf_intervalB[,2], col="black", lty=3)
lines(newxB, conf_intervalB[,3], col="black", lty=3)

legend("bottomright",
       legend = c("Extant Palaeognathae",  "Dinornithiformes", "Aepyornithiformes", substitute(paste(italic("Illbandornis lawsoni"))), substitute(paste(italic("Illbandornos woodburnei"))), substitute(paste(italic("Genyornis newtoni")))),
       pch = c(18, 18, 18, 10, 13, 19),
       col = c( "#3333cc", "#F77F00", "#cc0000", "#33cc33", "#33cc33","#33cc33"),
       pt.bg = c( "#3333cc", "#F77F00", "#cc0000", "#33cc33", "#33cc33", "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")

  
```


```{r plotting circumference just large birds}

pch_values3 <- c("Genyornis newtoni" = 19,"Dromornis stirtoni" = 8,  "Casuarius casuarius" = 15, "Dromaius novaehollandiae" = 17, "Struthio camelus" = 18)

pch_vector3 <- pch_values3[largebirds_plot$species]



#getting a model for predicting CIs
modelCircLB<- lm(fCIRC ~ tbCIRC, data=lb_noD_plot)
summary(modelCircLB)

#For the interval estimate to work, we need to find the smallest and largest values of x. All this is in https://stackoverflow.com/questions/46459620/plotting-a-95-confidence-interval-for-a-lm-object

#But X in this case has NAs so we're here finding the lowest non-NA value by sorting from smallest to largest and taking the first value
min_xCIRCLB <- sort(lb_noD_plot$tbCIRC)[1]
max_xCIRCLB <- sort(lb_noD_plot$tbCIRC, decreasing = TRUE)[1]

#make dummy sequence of x for intervals. 
newxCIRCLB <- seq(min_xCIRCLB-1,max_xCIRCLB+1,by = 0.05 )

#plot confidence intervals

#This only works if the data are already logged. Not my preference but hey.
conf_intervalCIRCLB <- predict(modelCircLB, newdata=data.frame(tbCIRC = newxCIRCLB), interval="prediction", level = 0.95)

plot(data=largebirds_plot, fCIRC ~ tbCIRC, 
     pch=pch_vector3, col=colours, ylab = "Femur circumference", xlab = "Tibiotarsus circumference",axes = TRUE, frame.plot = TRUE); abline(modelCircLB, col="black" )

lines(newxCIRCLB, conf_intervalCIRCLB [,2], col="black", lty=2)
lines(newxCIRCLB, conf_intervalCIRCLB [,3], col="black", lty=2)

#fill in area between regression line and confidence interval - very pretty but then you have to re-plot the points
polygon(c(rev(newxCIRCLB), newxCIRCLB), c(rev(conf_intervalCIRCLB [ ,3]), conf_intervalCIRCLB[ ,2]),density = 25, col = 'grey90', border = NA)

points(data=largebirds_plot, fCIRC ~ tbCIRC, 
     pch=pch_vector3, col=colours); abline(modelCircLB, col="black" )

lines(newxCIRCLB, conf_intervalCIRCLB [,2], col="black", lty=2)
lines(newxCIRCLB, conf_intervalCIRCLB [,3], col="black", lty=2)

legend("bottomright",
       legend = c(substitute(paste(italic("Struthio camelus"))), substitute(paste(italic("Dromaius novaehollandiae"))), substitute(paste(italic("Casuarius casuarius"))), substitute(paste(italic("Dromornis stirtoni"))), substitute(paste(italic("Genyornis newtoni")))),
       pch = c(18, 17, 15, 8, 19),
       col = c( "#3333cc", "#3333cc", "#3333cc", "#33cc33",  "#33cc33"),
       pt.bg = c( "#3333cc","#3333cc", "#3333cc", "#33cc33", "#33cc33"),
       bty = "n",
       pt.cex = 1.5,
       cex = 1,
       text.col = "black",
       horiz = F ,
       inset = c(0.01, 0.0), 
       ncol=2, 
       x.intersp=2,
       y.intersp=1.2)
box(col = "#000000")



```



#RANGE OF MOTION


```{r range plot base code}

data %>%
  ggplot(aes(x = Education)) +
  geom_linerange(aes(ymin = Women, ymax = Men, x = Education),
                 size = 1.5, alpha = 0.25) +
  geom_point(aes(y = Women), colour = "#CB5416") +
  geom_point(aes(y = Men), colour = "#267266") +
  coord_flip() +
  scale_y_continuous(labels = scales::dollar_format()) +
  ylab("Income") +
  theme_bw(base_size = 16) +
  theme(axis.title.y = element_blank())

#website
#https://stackoverflow.com/questions/66879914/how-to-make-range-plot-in-r


```


```{r femoral splay}

#making a subset dataset that includes just the femoral dorsal view angluar measurements aka the femoral splay
fem_splay <- na.omit(cbind(data_plot [,1:3], data_plot[,25:27]))

#this makes the species labels along the y axis run in this order
fem_splay$species <- factor (fem_splay$species, levels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Alectura lathami",	"Leipoa ocellata",	"Cereopsis novaehollandiae","Anseranas semipalmata",		"Anhima cornuta", "Genyornis newtoni"))

#code for range plot
ggplot (fem_splay, aes (x = species)) +
  geom_linerange(aes(ymin = hdp, ymax = hdr, x = species)) +
  geom_point (aes (y = hdp), color = "#CB5416") +
  geom_point(aes(y = hdr), color =  "#267266") +
  geom_point(aes(y = hds), color = "black")+
  coord_flip() +
  ylab("Femoral splay") +
  xlab ("Species") +
  scale_y_continuous(limits = c(10, 50), breaks = seq (10, 50, by = 10)) +
  theme_light(base_size = 12) +
  theme(axis.text.y = element_text(face = 'italic'),
    panel.grid.major = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())


```


```{r hip range of motion}
#making a subset dataset that includes just the femoral lateral view angluar measurements aka the hip ROM
hip_rom <- na.omit(cbind(data_plot [,1:3], data_plot[,19:21]))

#this makes the species labels along the y axis run in this order
hip_rom$species <- factor (hip_rom$species, levels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Alectura lathami",	"Leipoa ocellata",	"Cereopsis novaehollandiae","Anseranas semipalmata",		"Anhima cornuta", "Genyornis newtoni"))

ggplot (hip_rom, aes (x = species)) +
  geom_linerange(aes(ymin = hlp, ymax = hlr, x = species)) +
  geom_point (aes (y = hlp), colour= "#CB5416") +
  geom_point(aes(y = hlr), colour = "#267266") +
  geom_point(aes(y = hls), color = "black")+
  coord_flip() +
  ylab("Hip ROM") +
   xlab ("Species") +
  scale_y_continuous(limits = c(20, 80), breaks = seq (20,80, by = 10)) +
  theme_light(base_size = 12) +
  theme(axis.text.y = element_text(face = 'italic'),
    panel.grid.major = element_blank(),
   panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())


```


```{r knee range of motion}
#making a subset dataset that includes just the femoral lateral view angluar measurements aka the hip ROM
knee_rom <- na.omit(cbind(data_plot [,1:3], data_plot[,28:30]))

#this makes the species labels along the y axis run in this order
knee_rom$species <- factor (knee_rom$species, levels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Alectura lathami",	"Leipoa ocellata",	"Cereopsis novaehollandiae","Anseranas semipalmata",		"Anhima cornuta", "Genyornis newtoni"))


ggplot (knee_rom, aes (x = species)) +
  geom_linerange(aes(ymin = klf, ymax = kle, x = species)) +
  geom_point (aes (y = klf), colour= "#CB5416") +
  geom_point(aes(y = kle), colour = "#267266") +
  geom_point(aes(y = kls), color = "black")+
  coord_flip() +
  ylab("Knee ROM") +
  xlab ("Species") +
  scale_y_continuous(limits = c(30, 160), breaks = seq (30, 160, by = 10)) +
  theme_light(base_size = 12) +
  theme(axis.text.y = element_text(face = 'italic'),
    panel.grid.major = element_blank(),
   panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())


```


```{r intermetatarsal range of motion}

#making a subset dataset that includes just the femoral lateral view angluar measurements aka the hip ROM
int_rom <- na.omit(cbind(data_plot [,1:3], data_plot[,34:36]))

#this makes the species labels along the y axis run in this order
int_rom$species <- factor (int_rom$species, levels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Alectura lathami",	"Leipoa ocellata",	"Cereopsis novaehollandiae","Anseranas semipalmata",		"Anhima cornuta", "Genyornis newtoni"))


ggplot (int_rom, aes (x = species)) +
  geom_linerange(aes(ymin = ilf, ymax = ile, x = species)) +
  geom_point (aes (y = ilf), colour= "#CB5416") +
  geom_point(aes(y = ile), colour = "#267266") +
  geom_point(aes(y = ils), color = "black")+
  coord_flip() +
  ylab("Intermetatarsal ROM") +
  xlab ("Species") + 
  scale_y_continuous(limits = c(0,180), breaks = seq (0,180, by = 10)) +
  theme_light(base_size = 12) +
  theme(axis.text.y = element_text(face = 'italic'),
    panel.grid.major = element_blank(),
   panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())



```


#REDUCED MAJOR AXIS REGRESSIONS

```{r rma femur mediolateral vs tibia mediolateral}

#make sure that lmodel2 is installed
library(lmodel2)

#trying to run a reduced major axis regression
#this creates the model that will hopefully work when creating CIs
data2_rma <- lmodel2(fM.L~tbM.L, data=data_plot2, "relative", "relative", nperm=99)
summary(data2_rma)

#very unpretty plots but a starting point
plot(data2_rma, "SMA")
plot(data2_rma, "RMA")


```

#LIMB PROPORTIONS

```{r raw code for bar plot}

# create a dataset
specie <- c(rep("sorgho" , 3) , rep("poacee" , 3) , rep("banana" , 3) , rep("triticum" , 3) )
condition <- rep(c("normal" , "stress" , "Nitrogen") , 4)
value <- abs(rnorm(12 , 0 , 15))
data <- data.frame(specie,condition,value)
 
# Stacked
ggplot(data, aes(fill=condition, y=value, x=specie)) + 
    geom_bar(position="stack", stat="identity")

#taken from here: https://r-graph-gallery.com/48-grouped-barplot-with-ggplot2



```


```{r graph of proportion of hindlimb in species}

#mean lengths of the femur, tibiotarsus, and tarsometatarsus
#Aepyornis hildebrandti is excluded as Hasnford and Turvery have no tibiotarsi measurements
mean_lengths <- read.csv (file = "../Data/Raw/mean_lengths_2.csv")

#making sure that the bone is a factor so that it stacks correctly in the plot
mean_lengths$bone <- factor(mean_lengths$bone, levels = c("Femur", "Tibiotarsus", "Tarsometatarsus"))

#this makes the species labels along the x axis run in this order
mean_lengths$species <- factor (mean_lengths$species, levels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Pachyornis elephantopus",	"Dinornis novaezealandiae",	"Dinornis robustus",	"Mullerornis modestus",	"Aepyornis maximus",	"Alectura lathami",	"Leipoa ocellata",	"Anseranas semipalmata",	"Cereopsis novaehollandiae",	"Anhima cornuta", "Dinornis stirtoni", "Illbandornis woodburnei",	"Illbandornis lawsoni",	"Genyornis newtoni"))

#code for the bar plot
ggplot(mean_lengths, aes(fill = bone, y = mean_length, x = species)) +
    geom_bar(position="fill", stat="identity") +
  geom_abline(slope=0, intercept=0.30, col = "black", lty =2)+
  #labels for the x, y axis, plot title, and legend
  labs(title = "Mean Lengths of Bones by Species",
       x = "Species",
       y = "Total pecentage of hindlimb legnth ",
       fill = "Hindlimb bone") +
 #colours for the hindlimb bones and order that they should plot as
   scale_fill_manual(values = c("Femur" = "#e31a1c", "Tibiotarsus" = "#1f78b4", "Tarsometatarsus" = "#33a02c")) +
  #y axis should be in 10% increments instead of the standaard 25%
  scale_y_continuous(breaks = seq(0, 1, by = 0.1),
                       labels = function(x) paste0(x * 100, "%")) +
  theme_light(base_size = 12) +
  #tilts the x axis labels vertical
  theme(axis.text.x = element_text(angle = 90, face = 'italic', vjust = 0.5, hjust = 1),
        panel.grid.major = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())
  
  

```


```{r graph of proportion of hindlimbs in birds excl. moas}

#making a seperate dataset w/o moas
meanL_noM <- mean_lengths [-c(10:18),]


#making sure that the bone is a factor so that it stacks correctly in the plot
meanL_noM$bone <- factor(meanL_noM$bone, levels = c("Femur", "Tibiotarsus", "Tarsometatarsus"))

#this makes the species labels along the x axis run in this order
meanL_noM$species <- factor (meanL_noM$species, levels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Mullerornis modestus",	"Aepyornis maximus",	"Alectura lathami",	"Leipoa ocellata",	"Anseranas semipalmata",	"Cereopsis novaehollandiae",	"Anhima cornuta", "Dinornis stirtoni", "Illbandornis woodburnei",	"Illbandornis lawsoni",	"Genyornis newtoni"))

#code for the bar plot
ggplot(meanL_noM, aes(fill = bone, y = mean_length, x = species)) + 
    geom_bar(position="fill", stat="identity") +
  geom_abline(slope=0, intercept=0.30, col = "black", lty =2)+
  #labels for the x, y axis, plot title, and legend
  labs(title = "Mean Lengths of Bones by Species",
       x = "Species",
       y = "Total pecentage of hindlimb legnth ",
       fill = "Hindlimb bone") +
 #colours for the hindlimb bones and order that they should plot as
   scale_fill_manual(values = c("Femur" = "#e31a1c", "Tibiotarsus" = "#1f78b4", "Tarsometatarsus" = "#33a02c")) +
  #y axis should be in 10% increments instead of the standaard 25%
  scale_y_continuous(breaks = seq(0, 1, by = 0.1),
                       labels = function(x) paste0(x * 100, "%")) +
  theme_light(base_size = 12) +
  #tilts the x axis labels vertical
  theme(axis.text.x = element_text(angle = 90,face = 'italic',  vjust = 0.5, hjust = 1),
        panel.grid.major = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank())
  
```


```{r ternary plot for hindlimb proportions}

longbone_length <- na.omit(cbind(data [,1:3], data[4],data[9], data [14]))

col_values4 <- c("Genyornis newtoni" = "#33cc33","Illbandornis lawsoni" = "#33cc33", "Illbandornis woodburnei" = "#33cc33", "Dromornis stirtoni" = "#33cc33", "Anhima cornuta" = "#ff0055", "Anseranas semipalmata" = "#ff0055", "Cereopsis novaehollandiae" = "#ff0055", "Leipoa ocellata" = "#800080", "Alectura lathami" = "#800080", "Casuarius casuarius" = "#3333cc", "Dromaius novaehollandiae" = "#3333cc", "Struthio camelus" = "#3333cc", "Dinornis robustus" = "#F77F00", "Dinornis novaezealandiae" = "#F77F00", "Pachyornis elephantopus" = "#F77F00", "Aepyornis hildebrandti" = "#cc0000", "Aepyornis maximus" = "#cc0000", "Mullerornis modestus" = "#cc0000")

col_vector4 <- col_values4 [longbone_length$species]

pch_values4 <- c("Genyornis newtoni" = 19,"Illbandornis lawsoni" = 10, "Illbandornis woodburnei" = 13, "Dromornis stirtoni" = 8, "Anhima cornuta" = 17, "Anseranas semipalmata" = 17, "Cereopsis novaehollandiae" = 17, "Leipoa ocellata" = 15, "Alectura lathami" = 15, "Casuarius casuarius" = 18, "Dromaius novaehollandiae" = 18, "Struthio camelus" = 18, "Dinornis robustus" = 18, "Dinornis novaezealandiae" = 18, "Pachyornis elephantopus" = 18, "Aepyornis hildebrandti" = 18, "Aepyornis maximus" = 18, "Mullerornis modestus" = 18)

pch_vector4 <- pch_values4[longbone_length$species]


#trying a different method with the package Ternary
par(mar=c(0,0,0,0))

#make the legnths a matrix
#make sure na.omit is used otherwise it does not work
Ternary_matrix <- as.matrix (longbone_length[,c ("fL", "tbL", "tmtL")])

#creates the base for the plot
TernaryPlot(point = "up",
            alab = "Femur", blab = "Tibiotarsus", clab = "Tarsometatarsus",
            region = Ternary_matrix)

#adding points
TernaryPoints(Ternary_matrix,
              pch = pch_vector4,
              cex = 1.5,
              col = col_vector4)

```


``` {r Angst et al. 2016 locomotion whole dataset}

#a ggplot is the base function
#often will be followed by a '+' sign
#here i am plotting the ratio of the tarsometatarsus length and medial-lateral width against the medial lateral width
#running this on my complete dataset of just tarsometatarsus measurements
tmt_data <- read.csv (file = "../Data/Raw/tmt_data.csv")

#this makes the species labels along the x axis run in this order
tmt_data$species <- factor (tmt_data$species, levels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Pachyornis elephantopus",	"Dinornis novaezealandiae",	"Dinornis robustus",	"Mullerornis modestus",	"Aepyornis hildebrandti", "Aepyornis maximus",	"Alectura lathami",	"Leipoa ocellata",	"Anseranas semipalmata",	"Cereopsis novaehollandiae", "Anhima cornuta", 	"Dromornis stirtoni", "Illbandornis woodburnei",	"Illbandornis lawsoni",	"Genyornis newtoni"))

#code for plotting
ggplot(
  data = tmt_data,
  mapping = aes(x = tmtL/tmtM.L, y = tmtM.L, color = species)
) +
  geom_point() +
  geom_vline(xintercept = 12) +
  labs(
    x = "Tarsometatarsus length/medial-lateral width (mm)", y = "Tarsometatarsus medial-lateral width (mm)",
    color = "Species", shape = "Species" ) +
  scale_y_continuous(limits = c(0, 100), breaks = seq (0, 100, by = 20)) +
  scale_x_continuous(limits = c(0, 30), breaks = seq (0, 30, by = 5)) +
  theme_minimal() +
  theme (axis.line = element_line(colour = "grey50"), 
         panel.grid = element_blank())

#code for plotting
ggplot(
  data = tmt_data,
  mapping = aes(x = tmtL/tmtM.L, y = tmtM.L, color = order)
) +
  geom_point() +
  geom_vline(xintercept = 12, lty = 2) +
  labs(
    x = "Tarsometatarsus length/medial-lateral width (mm)", y = "Tarsometatarsus medial-lateral width (mm)",
    color = "Order", shape = "Order") +
  scale_y_continuous(limits = c(0, 100), breaks = seq (0, 100, by = 20)) +
  scale_x_continuous(limits = c(0, 30), breaks = seq (0, 30, by = 5)) +
  theme_minimal() +
  theme (axis.line = element_line(colour = "grey50"), 
         panel.grid = element_blank())





#library("RColorBrewer") # pkg for nice colours
#palette = brewer.pal(17, "Set3") 

#display.brewer.all()

#here is the link that I was using https://r4ds.hadley.nz/data-visualize
#geom_point removes rows containing missing values or values outside the scale range

#might see what it looks like log() transformed, but currently (26/06/2024) am happy not to


```


```{r Angst et al. 2016 locomotion just large birds}

#creating a sub dataset for just the flightless birds
#make a data set with extant ratites
ratite_tmt <- tmt_data[c(5:25),]

#make a data set with extinct large birds (ratites + dromorntithids)
extinct_tmt <- tmt_data[c(77:183),]

#combine the 2 datasets
largebirds_tmt <- rbind(ratite_tmt, extinct_tmt)

#this makes the species labels along the x axis run in this order
largebirds_tmt$species <- factor (largebirds_tmt$species, levels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Pachyornis elephantopus",	"Dinornis novaezealandiae",	"Dinornis robustus",	"Mullerornis modestus",	"Aepyornis hildebrandti", "Aepyornis maximus",	"Dromornis stirtoni", "Illbandornis woodburnei",	"Illbandornis lawsoni",	"Genyornis newtoni"))


#a ggplot is the base function
#often will be followed by a '+' sign
#here i am plotting the ratio of the tarsometatarsus length and medial-lateral width against the medial lateral wdith
#running this on just that dataset containing large flightless birds
ggplot( data = largebirds_tmt,
  mapping = aes(x = tmtL/tmtM.L, y = tmtM.L, color = species)
) +
  geom_point() +
  scale_colour_manual(name = "Species", values = c("#3333cc", "#3333cc", "#3333cc", "#b34700", "#b34700","#b34700","#cc0000", "#cc0000", "#cc0000", "#33cc33", "#33cc33","#33cc33"), labels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Pachyornis elephantopus",	"Dinornis novaezealandiae",	"Dinornis robustus",	"Mullerornis modestus",	"Aepyornis hildebrandti", "Aepyornis maximus",	"Illbandornis woodburnei",	"Illbandornis lawsoni",	"Genyornis newtoni"))+
  geom_vline(xintercept = 12, lty = 2) +
  labs(
    x = "Tarsometatarsus length/medial-lateral width (mm)", y = "Tarsometatarsus medial-lateral width (mm)") + #color = "Species", shape = "Species") +
  scale_y_continuous(limits = c(10, 100), breaks = seq (20, 100, by = 20)) +
  scale_x_continuous(limits = c(0, 30), breaks = seq (0, 30, by = 5)) +
  theme_minimal() +
  theme (axis.line = element_line(colour = "grey50"), 
         panel.grid = element_blank())

ggplot( data = largebirds_tmt,
  mapping = aes(x = tmtL/tmtM.L, y = tmtM.L, color = order)) +
  geom_point() +
  #scale_colour_manual(name = "Order", values = c("#3333cc", "#3333cc", "#3333cc", "#b34700", "#b34700","#b34700","#cc0000", "#cc0000", "#cc0000", "#33cc33", "#33cc33","#33cc33"), labels = c("Struthio camelus", "Casuarius casuarius",	"Dromaius novaehollandiae",	"Pachyornis elephantopus",	"Dinornis novaezealandiae",	"Dinornis robustus",	"Mullerornis modestus",	"Aepyornis hildebrandti", "Aepyornis maximus",	"Illbandornis woodburnei",	"Illbandornis lawsoni",	"Genyornis newtoni"))+
  geom_vline(xintercept = 12, lty = 2) +
  labs( x = "Tarsometatarsus length/medial-lateral width (mm)", y = "Tarsometatarsus medial-lateral width (mm)", color = "Order", shape = "Order") +
  scale_y_continuous(limits = c(10, 100), breaks = seq (20, 100, by = 20)) +
  scale_x_continuous(limits = c(0, 30), breaks = seq (0, 30, by = 5)) +
  theme_minimal() +
  theme (axis.line = element_line(colour = "grey50"), 
         panel.grid = element_blank())



#palette = brewer.pal(12, "Set3") 

#display.brewer.all()

#scale_colour_manual(name = "Species", values = c("#800080", "#ff0055", "#3333cc", "#b34700", "#cc0000", "#33cc33", "green", "#454B1B","#33cc33"), labels = c("Galliformes", "Anseriformes", "Extant Palaeognathae",  "Dinornithiformes", "Aepyornithiformes", "Illbandornis lawsoni", "Illbandornos woodburnei", "Dromornis stirtoni", "Genyornis newtoni"))+


#if I add the colours to the species, the legend than assigns the species as hex values
#geom_point removes rows containing missing values or values outside the scale range


#https://viz-ggplot2.rsquaredacademy.com/ggplot2-modify-legend
#https://www.jumpingrivers.com/blog/intro-to-theme-ggplot2-r/

```


